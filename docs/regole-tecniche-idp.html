

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
    <meta charset="utf-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Regole tecniche Identity Provider &mdash; SPID - Regole Tecniche 1.0 documentazione</title>
               
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />   
    <link rel="index" title="Indice" href="genindex.html" />
    <link rel="search" title="Cerca" href="search.html" />
    <link rel="top" title="SPID - Regole Tecniche 1.0 documentazione" href="index.html" />
    <link rel="next" title="Regole tecniche Service Provider" href="regole-tecniche-sp.html" />
    <link rel="prev" title="Introduzione" href="introduzione.html" />  
    <script src="_static/js/modernizr.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,600" rel="stylesheet">

</head>

<body class="wy-body-for-nav" role="document">
<div id="slimheader">
    <div class="sh__wrapper">
    <div class="sh__institutional">
        <a href="http://www.agid.gov.it/" title="Agid">AgID</a>
        <span class="sh__plus">&nbsp;+&nbsp;</span>
        <a href="https://teamdigitale.governo.it/" title="Team Digitale">Team Digitale</a>
    </div><!--/sh__institutional-->
    <div class="sh__tabs">
    <ul class="sh__tabsul">      
      <li class="delimiter"><a  href="https://trasformazionedigitale.italia.it">Trasformazione digitale</a></li>
      <li class="delimiter"><a href="https://developers.italia.it/">Developers</a></li>   
      <li class=""><a  href="http://design.italia.it">Designers</a></li>      
      <li class=""><a href="https://forum.developers.italia.it/">Forum</a></li>
      <li class="current"><a href="https://docs.developers.italia.it/">Docs</a></li>
      <li class=""><a href="https://github.com/italia/">Github</a></li>
    </ul>
    </div><!--/.sh__tabs-->
    </div><!--/.wrapper-->
</div><!--/#slimheader-->


     
    <div class="wy-grid-for-nav">

        
        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
            <div class="wy-side-scroll">
                <div class="wy-side-nav-search">
                    

                    <div class="branding clearfix">
                        <div class="branding--logo">
                            <a href="https://docs.developers.italia.it">
                              <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160">
                              <g fill="none" fill-rule="evenodd">
                                <path d="M0 0h160v160H0z"/>
                                <path fill="#fff" d="M58.28 131.956V49.918h21.5v82.184h-21.5v-.146zm84.435-63.353h-19.65v33.72c0 3.358.143 5.547.285 7.007.143 1.314.712 2.482 1.71 3.504.996 1.02 2.562 1.46 4.698 1.46l12.245-.293.997 17.52c-7.12 1.606-12.673 2.48-16.375 2.48-9.682 0-16.232-2.19-19.65-6.713-3.56-4.38-5.267-12.554-5.267-24.524V27h21.5v22.772h19.65v18.83h-.143zM25.957 74.88c-3.702 0-6.834-1.314-9.255-3.94C14.282 68.31 13 65.1 13 61.303c0-3.795 1.28-7.007 3.56-9.634 2.42-2.63 5.553-3.798 9.255-3.798 3.702 0 6.835 1.314 9.255 3.942 2.42 2.627 3.56 5.84 3.56 9.78 0 3.942-1.14 7.007-3.56 9.635-2.278 2.335-5.268 3.65-9.113 3.65z"/>
                              </g>
                            </svg>
                          </a>
                        </div>
                        <div class="branding--content">
                        
                            <h2 class="branding--title">
                                <span class="branding--title--branch">/ <a href="https://docs.developers.italia.it">docs</a></span>
                            </h2>
                        </div>
                        <h3 class="branding--tagline">La community italiana degli sviluppatori di servizi pubblici</h3>
                    </div>

            
            
            <h1 class="project-title"><a href="index.html" > SPID - Regole Tecniche </a></h1>
            


                     
                    
                    <div class="version">1</div>
                      
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div> 
                </div>

                <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduzione.html">Introduzione</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Regole tecniche Identity Provider</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#specifiche-delle-interfacce">Specifiche delle interfacce</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#assertion">&lt;Assertion&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subject">&lt;Subject&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issuer">&lt;Issuer&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authstatement">&lt;AuthStatement&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#signature">&lt;Signature&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attributestatement">&lt;AttributeStatement&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advice">&lt;Advice&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#esempio-asserzione-di-autenticazione">Esempio: asserzione di autenticazione</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#authnrequest">AuthnRequest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">&lt;AuthnRequest&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">&lt;Subject&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">&lt;Issuer&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nameidpolicy">&lt;NameIDPolicy&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conditions">&lt;Conditions&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requestedauthncontext">&lt;RequestedAuthnContext&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">&lt;Signature&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scoping">&lt;Scoping&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requesterid">&lt;RequesterID&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#esempio-di-authnrequest">Esempio di AuthnRequest</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#response">Response</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">&lt;Response&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#status">&lt;Status&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">&lt;Issuer&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">&lt;Assertion&gt;</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#caratteristiche-del-binding">Caratteristiche del Binding</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#binding-http-redirect">Binding HTTP Redirect</a></li>
<li class="toctree-l3"><a class="reference internal" href="#esempio-http-redirect-query-string">Esempio: HTTP redirect query string</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binding-http-post">Binding HTTP POST</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gestione-della-sicurezza-sul-canale-di-trasmissione">Gestione della sicurezza sul canale di trasmissione</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metadata">Metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#entitydescriptor">&lt;EntityDescriptor&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#idpssodescriptor">&lt;IDPSSODescriptor&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keydescriptor">&lt;KeyDescriptor&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nameidformat">&lt;NameIDFormat&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#singlelogoutservice">&lt;SingleLogoutService&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#singlesignonservice">&lt;SingleSignOnService&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attribute">&lt;Attribute&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">&lt;Signature&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#organization">&lt;Organization&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#esempio-metadata-idp">Esempio: Metadata IdP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#disponibilita-dei-metadata">Disponibilit√† dei Metadata</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="regole-tecniche-sp.html">Regole tecniche Service Provider</a></li>
<li class="toctree-l1"><a class="reference internal" href="regole-tecniche-aa.html">Regole tecniche Attribute Authority</a></li>
<li class="toctree-l1"><a class="reference internal" href="sessioni.html">Sessioni</a></li>
<li class="toctree-l1"><a class="reference internal" href="registro.html">Registro</a></li>
<li class="toctree-l1"><a class="reference internal" href="log.html">Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="elenco-attributi.html">Elenco attributi</a></li>
<li class="toctree-l1"><a class="reference internal" href="messaggi-errore.html">Messaggi di errore</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfacce.html">Interfacce</a></li>
</ul>
  
                </div>
            </div>
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

            
            <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
                
                <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
                <a href="index.html">SPID - Regole Tecniche</a> 
            </nav>


            
            <div class="wy-nav-content">
                <div class="rst-content">
                    















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Regole tecniche Identity Provider</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/regole-tecniche-idp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
                    <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                        <div itemprop="articleBody">
                            
  <div class="section" id="regole-tecniche-identity-provider">
<h1>Regole tecniche Identity Provider<a class="headerlink" href="#regole-tecniche-identity-provider" title="Link a questa intestazione">¬∂</a></h1>
<p><strong>Il Gestore delle identit√† (Identity Provider o IdP)</strong> <em>gestisce gli utenti e la procedura di autenticazione a seguito di una richiesta da parte di un Fornitore di Servizi (Service Provider o SP).</em></p>
<div class="section" id="specifiche-delle-interfacce">
<h2>Specifiche delle interfacce<a class="headerlink" href="#specifiche-delle-interfacce" title="Link a questa intestazione">¬∂</a></h2>
<p>L‚Äôasserzione prodotta dall‚ÄôIdentity Provider deve essere conforme allo standard SAML v2.0 <a class="reference external" href="https://docs.oasis-open.org/security/saml/v2.0/saml-core-2.0-os.pdf">(SAML Core)</a> e rispettare le seguenti condizioni:</p>
<div class="section" id="assertion">
<h3>&lt;Assertion&gt;<a class="headerlink" href="#assertion" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>nell‚Äôelemento <strong>&lt;Assertion&gt;</strong> devono essere presenti i seguenti attributi:</p>
<blockquote class="last">
<div><ul class="simple">
<li>l‚Äôattributo <strong>ID</strong> univoco, per esempio basato su un Universally Unique Identifier (UUID) o su una combinazione origine + timestamp  (quest‚Äôultimo generato con una precisione di almeno un millesimo di secondo per garantire l‚Äôunivocit√†);</li>
<li>l‚Äôattributo <strong>Version</strong>, che deve valere sempre ¬´2.0¬ª, coerentemente con la  versione della specifica SAML adottata;</li>
<li>l‚Äôattributo <strong>IssueInstant</strong> a indicare l‚Äôistante di emissione della richiesta, in formato UTC (esempio: ¬´2017-03-01T15:05:10.531Z¬ª);</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="subject">
<h3>&lt;Subject&gt;<a class="headerlink" href="#subject" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>deve essere presente l‚Äôelemento <strong>&lt;Subject&gt;</strong> a referenziare il soggetto che si √® autenticato in cui devono comparire gli elementi:</p>
<blockquote class="last">
<div><ul>
<li><p class="first"><strong>&lt;NameID&gt;</strong> atto a qualificare il soggetto dell‚Äôasserzione, in cui sono presenti i seguenti attributi:</p>
<ul class="simple">
<li><strong>Format</strong> che deve assumere il valore ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:nameidformat:transient">urn:oasis:names:tc:SAML:2.0:nameidformat:transient</a>¬ª <a class="reference external" href="https://docs.oasis-open.org/security/saml/v2.0/saml-core-2.0-os.pdf">(SAML Core, par8.3)</a></li>
<li><strong>NameQualifier</strong> che qualifica il dominio a cui afferisce tale valore (URI riconducibile all‚ÄôIdentity Provider stesso)</li>
</ul>
</li>
<li><p class="first"><strong>&lt;SubjectConfirmation&gt;</strong> contenente l‚Äôattributo</p>
<blockquote>
<div><ul class="simple">
<li><em>Method</em> riportante il valore ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:cm:bearer">urn:oasis:names:tc:SAML:2.0:cm:bearer</a>¬ª</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>&lt;SubjectConfirmationData&gt;</strong> riportante gli attributi:</p>
<blockquote>
<div><ul class="simple">
<li><em>Recipient</em> riportante l‚ÄôAssertionConsumerServiceURL relativa al servizio per cui √® stata emessa l‚Äôasserzione e l‚Äôattributo</li>
<li><em>NotOnOrAfter</em> che limita la finestra di tempo durante la quale l‚Äôasserzione pu√≤ essere propagata.</li>
<li><em>InResponseTo</em>, il cui valore deve fare riferimento all‚ÄôID della richiesta.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="issuer">
<h3>&lt;Issuer&gt;<a class="headerlink" href="#issuer" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>deve essere presente l‚Äôelemento <strong>&lt;Issuer&gt;</strong> a indicare l‚ÄôentityID dell‚ÄôIdentity Provider emittente (attualizzato come l‚Äôattributo entityID presente nei corrispondenti IdP metadata) con l‚Äôattributo Format riportante il valore ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:nameidformat:entity">urn:oasis:names:tc:SAML:2.0:nameidformat:entity</a>¬ª;</p>
<blockquote class="last">
<div><ul>
<li><p class="first">deve essere presente l‚Äôelemento <strong>&lt;Conditions&gt;</strong> in cui devono essere presenti gli attributi:</p>
<blockquote>
<div><ul class="simple">
<li><strong>NotBefore</strong>,</li>
<li><strong>NotOnOrAfter</strong>;</li>
<li>l‚Äôelemento <strong>&lt;AudienceRestriction&gt;</strong> riportante a sua volta l‚Äôelemento <strong>&lt;Audience&gt;</strong> attualizzato con l‚ÄôentityID del ServiceProvider per il quale l‚Äôasserzione √® emessa;</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="authstatement">
<h3>&lt;AuthStatement&gt;<a class="headerlink" href="#authstatement" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>deve essere presente l‚Äôelemento <strong>&lt;AuthStatement&gt;</strong> a sua volta contenente l‚Äôelemento:</p>
<blockquote class="last">
<div><ul class="simple">
<li><strong>&lt;AuthnContext&gt;</strong> riportante nel sotto elemento &lt;AuthnContextClassRef&gt; la classe relativa all‚Äôeffettivo contesto di autenticazione (es. <a class="reference external" href="https://www.spid.gov.it/SpidL2">https://www.spid.gov.it/SpidL2</a>);</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="signature">
<h3>&lt;Signature&gt;<a class="headerlink" href="#signature" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Deve essere presente l‚Äôelemento <strong>&lt;Signature&gt;</strong>
riportante la firma sull‚Äôasserzione apposta dall‚ÄôIdentity Provider emittente. La firma deve essere prodotta secondo il profilo specificato per SAML (cfr [SAML-Core] cap5) utilizzando chiavi RSA almeno a 2048 bit e algoritmo di digest SHA-256 o superiore</p>
</div>
</div>
<div class="section" id="attributestatement">
<h3>&lt;AttributeStatement&gt;<a class="headerlink" href="#attributestatement" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>pu√≤ essere presente l‚Äôelemento <strong>&lt;AttributeStatement&gt;</strong> riportante gli attributi identificativi certificati dall‚ÄôIdentity provider. Tale elemento se presente dovr√† comprendere:</p>
<blockquote class="last">
<div><ul class="simple">
<li>uno o pi√π elementi di tipo <strong>&lt;Attribute&gt;</strong> relativi ad attributi che l‚ÄôIdentity Provider pu√≤ rilasciare (cfr. Tabella attributi SPID) su richiesta del Service Provider espressa attraverso l‚Äôattributo AttributeConsumingServiceIndex quando presente nella authnrequest;</li>
<li>per gli elementi &lt;AttributeValue&gt; si raccomanda l‚Äôuso dell‚Äôattributo xsi:type attualizzato come specificato nella Tabella attributi SPID;</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="advice">
<h3>&lt;Advice&gt;<a class="headerlink" href="#advice" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>pu√≤ essere presente un elemento <strong>&lt;Advice&gt;</strong></p>
<blockquote>
<div><em>pu√≤ contenere a sua volta altri elementi **&lt;Assertion&gt;*</em>. La possibile presenza dell‚Äôelemento, prevista per futuri usi, consente, nei casi in cui gli statement emessi dall‚ÄôIdentity Provider si basino su altre asserzioni SAML ottenute da altre authority, di fornire evidenza delle stesse in forma originale unitamente alla risposta alla richiesta di autenticazione.</div></blockquote>
<p class="last"><em>L‚Äôelemento</em> <strong>&lt;Advice&gt;</strong> <em>√® previsto per futuri usi ed al momento non deve essere utilizzato.</em></p>
</div>
</div>
<div class="section" id="esempio-asserzione-di-autenticazione">
<h3>Esempio: asserzione di autenticazione<a class="headerlink" href="#esempio-asserzione-di-autenticazione" title="Link a questa intestazione">¬∂</a></h3>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;saml:Assertion</span> <span class="na">xmlns:saml=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span>
    <span class="na">ID=</span><span class="s">&quot;_27e00421b56a5aa5b7332...&quot;</span> <span class="na">IssueInstant=</span><span class="s">&quot;2015-01-29T10:01:03Z&quot;</span> <span class="na">Version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ds:Signature</span> <span class="na">xmlns:ds=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/ds:Signature&gt;</span>
    <span class="nt">&lt;saml:Issuer</span> <span class="na">Format=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:nameid-format:entity&quot;</span><span class="nt">&gt;</span>spididp.it<span class="nt">&lt;/saml:Issuer&gt;</span>
    <span class="nt">&lt;saml:Subject&gt;</span>
        <span class="nt">&lt;saml:NameID</span> <span class="na">Format=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:nameid-format:transient&quot;</span>
            <span class="na">NameQualifier=</span><span class="s">&quot;http://spid.idpprovider.it&quot;</span><span class="nt">&gt;</span>_06e983facd7cd554cfe067e...<span class="nt">&lt;/saml:NameID&gt;</span>
        <span class="nt">&lt;saml:SubjectConfirmation</span> <span class="na">Method=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:cm:bearer&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;saml:SubjectConfirmationData</span> <span class="na">Recipient=</span><span class="s">&quot;https://spid.serviceprovider.it/location0&quot;</span>
                <span class="na">NotOnOrAfter=</span><span class="s">&quot;2017-03-19T12:05:33Z&quot;</span>
                <span class="na">InResponseTo=</span><span class="s">&quot;_4d38c302617b5bf98951e...&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/saml:SubjectConfirmationData&gt;</span>
        <span class="nt">&lt;/saml:SubjectConfirmation&gt;</span>
    <span class="nt">&lt;/saml:Subject&gt;</span>
    <span class="nt">&lt;saml:Conditions</span> <span class="na">NotBefore=</span><span class="s">&quot;2017-03-19T12:05:33Z&quot;</span> <span class="na">NotOnOrAfter=</span><span class="s">&quot;2017-03-19T12:07:33Z&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;saml:AudienceRestriction&gt;</span>
            <span class="nt">&lt;saml:Audience&gt;</span>https://spidSP.serviceProvider.it <span class="nt">&lt;/saml:Audience&gt;</span>
        <span class="nt">&lt;/saml:AudienceRestriction&gt;</span>
    <span class="nt">&lt;/saml:Conditions&gt;</span>
    <span class="nt">&lt;saml:AuthnStatement</span> <span class="na">AuthnInstant=</span><span class="s">&quot;2017-03-19T12:05:33Z&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;saml:AuthnContext&gt;</span>
            <span class="nt">&lt;saml:AuthnContextClassRef&gt;</span>https://www.spid.gov.it/SpidL2<span class="nt">&lt;/saml:AuthnContextClassRef&gt;</span>
        <span class="nt">&lt;/saml:AuthnContext&gt;</span>
    <span class="nt">&lt;/saml:AuthnStatement&gt;</span>
    <span class="nt">&lt;saml:AttributeStatement</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchemainstance&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">Name=</span><span class="s">&quot;familyName&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;saml:AttributeValue</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span><span class="nt">&gt;</span>Rossi<span class="nt">&lt;/saml:AttributeValue&gt;</span>
        <span class="nt">&lt;/saml:Attribute&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">Name=</span><span class="s">&quot;spidCode&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;saml:AttributeValue</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span><span class="nt">&gt;</span>ABC123<span class="nt">&lt;/saml:AttributeValue&gt;</span>
        <span class="nt">&lt;/saml:Attribute&gt;</span>
    <span class="nt">&lt;/saml:AttributeStatement&gt;</span>
<span class="nt">&lt;/saml:Assertion&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="authnrequest">
<h2>AuthnRequest<a class="headerlink" href="#authnrequest" title="Link a questa intestazione">¬∂</a></h2>
<p>Il protocollo AuthnRequest previsto per l‚ÄôIdentity Provider deve essere conforme allo standard
SAML v2.0 (cfr. [SAML-Core]) e rispettare le condizioni di seguito indicate.</p>
<div class="section" id="id1">
<h3>&lt;AuthnRequest&gt;<a class="headerlink" href="#id1" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>nell‚Äù elemento &lt;AuthnRequest&gt; devono essere presenti i seguenti attributi:</p>
<blockquote class="last">
<div><ul class="simple">
<li>l‚Äôattributo <strong>ID</strong> univoco, per esempio basato su un Universally Unique Identifier (UUID) o su una combinazione origine + timestamp (quest‚Äôultimo generato con una precisione di almeno un millesimo di secondo per garantire l‚Äôunivocit√†)</li>
<li>l‚Äôattributo <strong>Version</strong>, che deve valere sempre ¬´2.0¬ª, coerentemente con la versione della specifica SAML adottata;</li>
<li>l‚Äôattributo <strong>IssueInstant</strong> a indicare l‚Äôistante di emissione della richiesta, in formato UTC (esempio: ¬´2017-03-05T18:03:10.531Z¬ª)</li>
<li>l‚Äôattributo <strong>Destination</strong>, a indicare l‚Äôindirizzo (URI reference) dell‚ÄôIdentity provider a cui √® inviata la richiesta, come risultante nell‚Äôattributo entityID presente nel metadata IdP dell‚ÄôIdentity Provider a cui viene inviata la richiesta</li>
<li>l‚Äôattributo <strong>ForceAuthn</strong> nel caso in cui si richieda livelli di autenticazione superiori a SPIDL1 ( SPIDL2 o SPIDL3)</li>
<li><dl class="first docutils">
<dt>l‚Äôattributo <strong>AssertionConsumerServiceIndex</strong>, riportante un indice posizionale facente riferimento ad uno degli elementi &lt;AttributeConsumerService &gt; presenti nei metadata del Service Provider, atto ad indicare, mediante l‚Äôattributo Location, l‚ÄôURL a cui inviare il messaggio di risposta alla richiesta di autenticazione, e mediante l‚Äôattributo Binding, il binding da utilizzare, quest‚Äôultimo valorizzato obbligatoriamente con ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST</a>¬ª</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>in alternativa, scelta sconsigliata, possono essere presenti</dt>
<dd><ul class="first last">
<li>l‚Äôattributo <strong>AssertionConsumerServiceURL</strong> ad indicare l‚ÄôURL a cui inviare il messaggio di risposta alla richiesta di autenticazione (l‚Äôindirizzo deve coincidere con quello del servizio riportato dall‚Äôelemento &lt;AssertionConsumingService&gt; presente nei metadata del Service Provider);</li>
<li>l‚Äôattributo <strong>ProtocolBinding</strong>, identificante il binding da utilizzare per inoltrare il messaggio di risposta, valorizzato con ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST</a>¬ª;</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">nell‚Äù elemento <strong>&lt;AuthnRequest&gt;</strong> non deve essere presente l‚Äôattributo IsPassive (ad indicare ¬´false¬ª come valore di default)</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>nell‚Äù elemento <strong>&lt;AuthnRequest&gt;</strong> si pu√≤ utilizzare opzionalmente l‚Äôattributo:</p>
<blockquote class="last">
<div><ul class="simple">
<li><strong>AttributeConsumingServiceIndex</strong> riportante un indice posizionale in riferimento alla struttura <strong>&lt;AttributeConsumingService&gt;</strong> presente nei metadata del Service Provider, atta a specificare gli attributi che devono essere presenti nell‚Äôasserzione prodotta. Nel caso l‚Äôattributo fosse assente l‚Äôasserzione prodotta non riporter√† alcuna attestazione di attributo</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="id2">
<h3>&lt;Subject&gt;<a class="headerlink" href="#id2" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>pu√≤ essere presente l‚Äôelemento <strong>&lt;Subject&gt;</strong> a indicare il soggetto per cui si chiede l‚Äôautenticazione in cui deve comparire:</p>
<blockquote class="last">
<div><ul class="simple">
<li><dl class="first docutils">
<dt>l‚Äôelemento <strong>&lt;NameID&gt;</strong> atto a qualificare il soggetto in cui sono presenti i seguenti attributi</dt>
<dd><ul class="first last">
<li><strong>Format</strong> che deve assumere il valore ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:nameid-format:unspecified">urn:oasis:names:tc:SAML:2.0:nameid-format:unspecified</a>¬ª (cfr. SAMLCore, sez. 8.3)</li>
<li><strong>NameQualifier</strong> che qualifica il dominio a cui afferisce tale valore (URI)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="id3">
<h3>&lt;Issuer&gt;<a class="headerlink" href="#id3" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>deve essere presente l‚Äôelemento <strong>&lt;Issuer&gt;</strong> attualizzato come l‚Äôattributo entityID riportato nel corrispondente SP metadata, a indicare l‚Äôidentificatore univoco del Service Provider emittente. L‚Äôelemento deve riportare gli attributi:</p>
<blockquote class="last">
<div><ul class="simple">
<li><strong>Format</strong> fissato al valore ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:nameid-format:entity">urn:oasis:names:tc:SAML:2.0:nameid-format:entity</a>¬ª</li>
<li><strong>NameQualifier</strong> che qualifica il dominio a cui afferisce tale valore (URI riconducibile al Service Provider stesso)</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="nameidpolicy">
<h3>&lt;NameIDPolicy&gt;<a class="headerlink" href="#nameidpolicy" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>deve essere presente l‚Äôelemento <strong>&lt;NameIDPolicy&gt;</strong> avente gli attributi</p>
<blockquote class="last">
<div><ul class="simple">
<li><strong>AllowCreate</strong>, se presente, valorizzato a ¬´true¬ª</li>
<li><strong>Format</strong> valorizzato come ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:nameid-format:transient">urn:oasis:names:tc:SAML:2.0:nameid-format:transient</a>¬ª</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="conditions">
<h3>&lt;Conditions&gt;<a class="headerlink" href="#conditions" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>l‚Äôelemento <strong>&lt;Conditions&gt;</strong>, se presente, deve indicare i limiti di validit√† attesi dell‚Äôasserzione ricevuta in risposta, per esempio specificando gli attributi</p>
<blockquote>
<div><ul class="simple">
<li><strong>NotBefore</strong> e <strong>NotOnOrAfter</strong> opportunamente valorizzati in formato UTC</li>
</ul>
</div></blockquote>
<p class="last"><em>N.B. L‚ÄôIdentity Provider non √® obbligato a tener conto dell‚Äôindicazione nel caso che questa non sia confacente con i criteri di sicurezza da esso adottati.</em></p>
</div>
</div>
<div class="section" id="requestedauthncontext">
<h3>&lt;RequestedAuthnContext&gt;<a class="headerlink" href="#requestedauthncontext" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>deve essere presente l‚Äôelemento <strong>&lt;RequestedAuthnContext&gt;</strong> (SAMLCore, sez. 3.3.2.2.1) ad indicare il contesto di autenticazione atteso, ossia la ¬´robustezza¬ª delle credenziali richieste. Allo scopo sono definite le seguenti ¬´authentication context class¬ª estese (SAMLAuthContext, sez. 3) in riferimento SPID:</p>
<blockquote>
<div><ul class="simple">
<li><strong>https://www.spid.gov.it/SpidL1</strong></li>
<li><strong>https://www.spid.gov.it/SpidL2</strong></li>
<li><strong>https://www.spid.gov.it/SpidL3</strong></li>
</ul>
</div></blockquote>
<p>referenziate dagli elementi <strong>&lt;AuthnContextClassRef&gt;</strong></p>
<p>Ciascuna di queste classi, indica in ordine di preferenza il contesto di autenticazione (atteso o effettivo) secondo alcune dimensioni di riferimento, quali per esempio i meccanismi di autenticazione con cui l‚ÄôIdentity Provider pu√≤ identificare l‚Äôutente. L‚Äôelemento <strong>&lt;RequestedAuthnContext&gt;</strong> prevede un attributo <strong>Comparison</strong> con il quale indicare il metodo per stabilire il rispetto del vincolo sul contesto di abilitazione: i valori ammessi per questo attributo sono:</p>
<blockquote>
<div><ul class="simple">
<li><strong>exact</strong></li>
<li><strong>minimum</strong></li>
<li><strong>better</strong></li>
<li><strong>maximum</strong></li>
</ul>
</div></blockquote>
<p>Nel caso dell‚Äôelemento <strong>&lt;RequestedAuthnContext&gt;</strong>, questa informazione si riflette sulle tipologie di meccanismi utilizzabili dall‚ÄôIdentity Provider ai fini dell‚Äôautenticazione dell‚Äôutente. L‚Äôesempio seguente di <strong>&lt;RequestedAuthnContext&gt;</strong> fa riferimento a una ¬´authentication context class¬ª di tipo ¬´SpidL2¬ª o superiore.</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;samlp:RequestedAuthnContext</span> <span class="na">Comparison=</span><span class="s">&quot;minimum&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;saml:AuthnContextClassRef&gt;</span>
        https://www.spid.gov.it/SpidL2
    <span class="nt">&lt;/saml:AuthnContextClassRef&gt;</span>
<span class="nt">&lt;/samlp:RequestedAuthnContext&gt;</span>
</pre></div>
</td></tr></table></div>
<p class="last"><em>N.B. L‚ÄôIdentity Provider ha facolt√† di utilizzare per l‚Äôautenticazione un livello SPID pi√π alto rispetto a quelli risultanti dall‚Äôindicazione del richiedente mediante l‚Äôattributo Comparison. Tale scelta non deve comportare un esito negativo della richiesta.</em></p>
</div>
</div>
<div class="section" id="id4">
<h3>&lt;Signature&gt;<a class="headerlink" href="#id4" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">nel caso del binding <strong>HTTP POST</strong> deve essere presente l‚Äôelemento <strong>&lt;Signature&gt;</strong> contenente la firma sulla richiesta apposta dal Service Provider. La firma deve essere prodotta secondo il profilo specificato per SAML (SAML-Core, cap. 5) utilizzando chiavi RSA almeno a 2048 bit e algoritmo di digest SHA-256 o superiore.</p>
</div>
</div>
<div class="section" id="scoping">
<h3>&lt;Scoping&gt;<a class="headerlink" href="#scoping" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">se presente l‚Äôelemento <strong>&lt;Scoping&gt;</strong> il relativo attributo ProxyCount deve assumere valore <em>¬´0¬ª</em> per indicare che l‚ÄôIdentity Provider invocato non pu√≤ delegare il processo di autenticazione ad altra Asserting Party.</p>
</div>
</div>
<div class="section" id="requesterid">
<h3>&lt;RequesterID&gt;<a class="headerlink" href="#requesterid" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>eventuali elementi <strong>&lt;RequesterID&gt;</strong> contenuti devono indicare l‚ÄôURL del servizio di reperimento metadati di ciascuna delle entit√† che hanno emesso originariamente la richiesta di autenticazione e di quelle che in seguito la hanno propagata, mantenendo l‚Äôordine che indichi la sequenza di propagazione (il primo elemento <em>&lt;RequesterID&gt;</em> dell‚Äôelemento <em>&lt;Scoping&gt;</em> √® relativo all‚Äôultima entit√† che ha propagato la richiesta).</p>
<p class="last">Gli elementi <em>&lt;Scoping&gt; &lt;RequesterID&gt;</em> sono previsti per futuri usi ed al momento non devono essere utilizzati. Nel caso di presenza di tali parametri nella richiesta questi dovranno essere al momento ignorati all‚Äôatto dell‚Äôelaborazione della risposta da parte dell‚ÄôIdentity Provider.</p>
</div>
</div>
<div class="section" id="esempio-di-authnrequest">
<h3>Esempio di AuthnRequest<a class="headerlink" href="#esempio-di-authnrequest" title="Link a questa intestazione">¬∂</a></h3>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;samlp:AuthnRequest</span> <span class="na">xmlns:samlp=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span>
    <span class="na">xmlns:saml=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span>
    <span class="na">ID=</span><span class="s">&quot;_4d38c302617b5bf98951e65b4cf304711e2166df20&quot;</span>
    <span class="na">Version=</span><span class="s">&quot;2.0&quot;</span>
    <span class="na">IssueInstant=</span><span class="s">&quot;2015-01-29T10:00:31Z&quot;</span>
    <span class="na">Destination=</span><span class="s">&quot;https://spid.identityprovider.it&quot;</span>
    <span class="na">AssertionConsumerServiceURL=</span><span class="s">&quot;http://spid.serviceprovider.it&quot;</span>
    <span class="na">ProtocolBinding=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot;</span>
    <span class="na">AttributeConsumingServiceIndex=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ds:Signature</span> <span class="na">xmlns:ds=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span><span class="nt">&gt;</span>
        [...]
    <span class="nt">&lt;/ds:Signature&gt;</span>
    <span class="nt">&lt;saml:Issuer</span>
        <span class="na">NameQualifier=</span><span class="s">&quot;http://spid.serviceprovider.it&quot;</span>
        <span class="na">Format=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:nameid-format:entity&quot;</span><span class="nt">&gt;</span>
        spid-sp
    <span class="nt">&lt;/saml:Issuer&gt;</span>
    <span class="nt">&lt;samlp:NameIDPolicy</span> <span class="na">Format=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:nameid-format:transient&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;samlp:RequestedAuthnContext</span> <span class="na">Comparison=</span><span class="s">&quot;exact&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;saml:AuthnContextClassRef&gt;</span>
            https://www.spid.gov.it/SpidL2
        <span class="nt">&lt;/saml:AuthnContextClassRef&gt;</span>
    <span class="nt">&lt;/samlp:RequestedAuthnContext&gt;</span>
<span class="nt">&lt;/samlp:AuthnRequest&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="response">
<h2>Response<a class="headerlink" href="#response" title="Link a questa intestazione">¬∂</a></h2>
<p>Le caratteristiche che deve avere la risposta inviata dall‚ÄôIdentity Provider al Service Provider a seguito di una richiesta di autenticazione sono le seguenti:</p>
<div class="section" id="id5">
<h3>&lt;Response&gt;<a class="headerlink" href="#id5" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>nell‚Äù elemento &lt;Response&gt; devono essere presenti i seguenti attributi:</p>
<ul class="last simple">
<li>l‚Äôattributo <em>ID</em> univoco basato, per esempio, su un Universally Unique Identifier (UUID) (cfr. UUID) o su una combinazione origine + timestamp (quest‚Äôultimo generato con una precisione di almeno un millesimo di secondo per garantire l‚Äôunivocit√†);</li>
<li>deve essere presente l‚Äôattributo <strong>Version</strong>, che deve valere sempre <em>¬´2.0¬ª</em>, coerentemente con la versione della specifica SAML adottata;</li>
<li>deve essere presente l‚Äôattributo <strong>IssueInstant</strong> a indicare l‚Äôistante di emissione della risposta, in formato UTC;</li>
<li>deve essere presente l‚Äôattributo <strong>InResponseTo</strong>, il cui valore deve fare riferimento all‚ÄôID della richiesta a cui si risponde;</li>
<li>deve essere presente l‚Äôattributo Destination, a indicare l‚Äôindirizzo (URI reference) del Service provider a cui √® inviata la risposta;</li>
</ul>
</div>
</div>
<div class="section" id="status">
<h3>&lt;Status&gt;<a class="headerlink" href="#status" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>deve essere presente l‚Äôelemento &lt;Status&gt; a indicare l‚Äôesito della AuthnRequest secondo quanto definito nelle specifiche SAML (SAML-Core, par. 3.2.2.1 e successivi) comprendente il sotto-elemento</p>
<blockquote>
<div><ul class="simple">
<li><strong>&lt;StatusCode&gt;</strong></li>
</ul>
</div></blockquote>
<p>ed opzionalmente i sotto-elementi</p>
<blockquote>
<div><ul class="simple">
<li><strong>&lt;StatusMessage&gt;</strong></li>
<li><strong>&lt;StatusDetail&gt;</strong></li>
</ul>
</div></blockquote>
<p class="last">(Messaggi di errore SPID)</p>
</div>
</div>
<div class="section" id="id6">
<h3>&lt;Issuer&gt;<a class="headerlink" href="#id6" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>deve essere presente l‚Äôelemento <strong>&lt;Issuer&gt;</strong> a indicare l‚ÄôentityID dell‚Äôentit√† emittente, cio√® l‚ÄôIdentity Provider stesso. L‚Äôelemento</p>
<blockquote class="last">
<div><ul class="simple">
<li><strong>Format</strong> omesso o fissato al valore ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:nameid-format:entity">urn:oasis:names:tc:SAML:2.0:nameid-format:entity</a>¬ª</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="id7">
<h3>&lt;Assertion&gt;<a class="headerlink" href="#id7" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">deve essere presente un elemento <strong>&lt;Assertion&gt;</strong> ad attestare l‚Äôavvenuta autenticazione, contenente almeno un elemento <strong>&lt;AuthnStatement&gt;</strong>.
Nel caso l‚ÄôIdentity Provider abbia riscontrato un errore nella gestione della richiesta di autenticazione l‚Äôelemento
<strong>&lt;Assertion&gt;</strong> non deve essere presente.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">pu√≤ essere presente l‚Äôelemento <strong>&lt;Signature&gt;</strong> contenente la firma sulla risposta apposta dall‚ÄôIdentity Provider.
La firma deve essere prodotta secondo il profilo specificato per SAML (SAML-Core, cap. 5) utilizzando chiavi RSA almeno a 2048 bit e algoritmo di digest SHA-256 o superiore.
Per l‚Äôasserzione veicolata resta valido quanto gi√† specificato nei dettagli delle <a class="reference external" href="regole-tecniche-idp.html#assertion">&lt;Assertion&gt;</a></p>
</div>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;md:EntityDescriptor</span> <span class="na">xmlns:md =</span> <span class="s">&quot;urn:oasis:names:tc:SAML:2.0:metadata&quot;</span>
    <span class="na">xmlns:saml=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchemainstance&quot;</span>
    <span class="na">entityID=</span><span class="s">&quot;http://spidIdp.idpProvider.it&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ds:Signature</span> <span class="na">xmlns:ds=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/ds:Signature&gt;</span>
    <span class="nt">&lt;md:IDPSSODescriptor</span>
        <span class="na">protocolSupportEnumeration=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span>
        <span class="na">WantAuthnRequestsSigned=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;md:KeyDescriptor</span> <span class="na">use=</span><span class="s">&quot;signing&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/md:KeyDescriptor&gt;</span>
        <span class="nt">&lt;md:NameIDFormat&gt;</span>
            urn:oasis:names:tc:SAML:2.0:nameid-format:transient
        <span class="nt">&lt;/md:NameIDFormat&gt;</span>
        <span class="nt">&lt;md:SingleSignOnService</span>
            <span class="na">Location=</span><span class="s">&quot;https://spid.identityprovider.it/redirect-Post-saml2sso&quot;</span>
            <span class="na">Binding=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;md:SingleSignOnService</span>
            <span class="na">Location=</span><span class="s">&quot;https://spid.identityprovider.it/Post-Post-saml2sso&quot;</span>
            <span class="na">Binding=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;familyName&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;spidCode&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;fiscalNumber&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;gender&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;dateOfBirth&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;placeOfBirth&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;companyName&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;registeredOffice&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;ivaCode&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;idCard&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;mobilePhone&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;email&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;address&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;digitalAddress&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/md:IDPSSODescriptor&gt;</span>
<span class="nt">&lt;/md:EntityDescriptor&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="caratteristiche-del-binding">
<h2>Caratteristiche del Binding<a class="headerlink" href="#caratteristiche-del-binding" title="Link a questa intestazione">¬∂</a></h2>
<div class="section" id="binding-http-redirect">
<h3>Binding HTTP Redirect<a class="headerlink" href="#binding-http-redirect" title="Link a questa intestazione">¬∂</a></h3>
<p>Nel caso del binding HTTP Redirect la richiesta viene veicolata con le seguenti modalit√†:</p>
<blockquote>
<div><ul class="simple">
<li><strong>come risposta alla richiesta di accesso</strong> dell‚Äôend user ad un servizio o risorsa, il Service Provider invia allo User Agent un messaggio HTTP di redirezione, cio√® avente uno status code con valore 302 (¬´Found¬ª) o 303 (¬´See Other¬ª)</li>
<li><strong>il Location Header del messaggio HTTP contiene</strong> l‚ÄôURI di destinazione del servizio di Single Sign-On esposto dall‚Äù Identity Provider. L‚Äôinterfaccia √® sempre la <strong>IAuthnRequest</strong></li>
<li><dl class="first docutils">
<dt><strong>il messaggio HTTP trasporta i seguenti parametri</strong> (tutti URL-encoded):</dt>
<dd><ol class="first last arabic">
<li><strong>¬´SAMLRequest¬ª</strong>: un costrutto SAML &lt;AuthnRequest&gt; codificato in formato Base64 e compresso con algoritmo DEFLATE. Come da specifica, il messaggio SAML non contiene la firma in formato XML Digital Signature esteso (come avviene in generale nel caso di binding HTTP POST). Ci√≤ a causa delle dimensioni eccessive che esso raggiungerebbe per essere veicolato in una query string. La specifica indica come modalit√† alternativa quella di specificare con parametri aggiuntivi l‚Äôalgoritmo utilizzato per firmare e la stringa con la codifica Base64 URL-encoded dei byte del messaggio SAML</li>
<li><strong>¬´RelayState¬ª</strong>: identifica la risorsa (servizio) originariamente richiesta dall‚Äôutente e a cui trasferire il controllo alla fine del processo di autenticazione. Il Service Provider a tutela della privacy dell‚Äôutente nell‚Äôutilizzare questo parametro deve mettere in atto accorgimenti tali da rendere minima l‚Äôevidenza possibile sulla natura o tipologia della risorsa (servizio) richiesta</li>
<li><strong>¬´SigAlg¬ª</strong>: identifica l‚Äôalgoritmo usato per la firma prodotta secondo il profilo specificato per SAML (SAML-Core, cap. 5) utilizzando chiavi RSA almeno a 2048 bit e algoritmo di digest SHA-256 o superiore; il valore esteso di questo parametro √® contestualizzato da un namespace appartenente allo standard XML Digital Signature. Come indicato al punto 1, tuttavia, la firma prodotta non fa uso della struttura XML definita in tale standard</li>
<li><strong>¬´Signature¬ª</strong>: contiene la firma digitale della query string, cos√¨ come prodotta prima di aggiungere questo parametro, utilizzando l‚Äôalgoritmo indicato al parametro precedente;</li>
<li><strong>Il browser dell‚Äôutente elabora quindi tale messaggio HTTP Redirect</strong> indirizzando una richiesta HTTP con metodo GET al servizio di Single Sign-On dell‚Äù Identity Provider (interfaccia IAuthnRequest) sotto forma di URL con tutti i sopraindicati parametri contenuti nella query string. Un esempio di tale URL √® il seguente, nel quale sono evidenziati in grassetto i parametri citati (i valori di alcuni parametri sono stati ridotti per brevit√†, inoltre il valore del parametro ¬´RelayState¬ª √® stato reso non immediatamente intellegibile, come suggerito dalla specifica, sostituendo la stringa in chiaro con l‚ÄôId della richiesta: il Service Provider tiene traccia della corrispondenza)</li>
</ol>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="esempio-http-redirect-query-string">
<h3>Esempio: HTTP redirect query string<a class="headerlink" href="#esempio-http-redirect-query-string" title="Link a questa intestazione">¬∂</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="s1">&#39;SAMLRequest&#39;</span><span class="o">=</span><span class="n">nVPLbtswELz3KwTeZb0M2SYsBa6NoAbSRrGUHnqjqFVDQCJVLuU4f19KlhEDb</span>
<span class="n">VygR5K7O7Mzw</span><span class="o">%</span><span class="mi">2</span><span class="n">FXdqW2cI2gUSiYkmPnEAclVJeTPhDwX</span><span class="o">%</span><span class="mi">2</span><span class="n">B6S3KWf1sjapqOb3rzIA</span><span class="o">%</span><span class="mi">2</span><span class="n">FzqAY2zQQRtbNtWSe</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">ZwPAU88aUQvQ</span><span class="o">%</span><span class="mi">2</span><span class="n">F8oe8S68piBDNabB5s3AyThb1XZMCxxEhhPj5qLZddW2sZIcoP4fBW</span><span class="o">%</span><span class="mi">2</span><span class="n">BWccqH0fZ6iNir0tU</span>
<span class="n">QGeCWZaGZxE5pM4n8Nz7p</span><span class="o">%</span><span class="mi">2</span><span class="n">Be2D3S6L51x1NljO</span><span class="o">%</span><span class="mi">2</span><span class="n">BCO2qh8zO</span><span class="o">%</span><span class="mi">2</span><span class="n">Bji</span><span class="o">%</span><span class="mi">2</span><span class="n">FfnN098</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">&amp;</span><span class="s1">&#39;RelayState&#39;</span><span class="o">=</span><span class="n">s29f6c7d</span>
<span class="mi">6</span><span class="n">bbf9e62968d27309e2e4beb6133663a2e</span><span class="o">&amp;</span><span class="s1">&#39;SigAlg&#39;</span><span class="o">=</span><span class="n">http</span><span class="o">%</span><span class="mi">3</span><span class="n">A</span><span class="o">%</span><span class="mi">2</span><span class="n">F</span><span class="o">%</span><span class="mi">2</span><span class="n">Fwww</span><span class="o">.</span><span class="n">w3</span><span class="o">.</span><span class="n">org</span><span class="o">%</span><span class="mi">2</span><span class="n">F2000</span><span class="o">%</span><span class="mi">2</span><span class="n">F09</span><span class="o">%</span><span class="mi">2</span><span class="n">Fxmldsig</span>
<span class="o">%</span><span class="mi">23</span><span class="n">rsa</span><span class="o">-</span><span class="n">sha1</span><span class="o">&amp;</span><span class="s1">&#39;Signature&#39;</span><span class="o">=</span><span class="n">LtNj</span><span class="o">%</span><span class="mi">2</span><span class="n">BbMc8j</span><span class="o">%</span><span class="mi">2</span><span class="n">FhglWzHPMmo0ESQzBaWlmQbZxas</span><span class="o">%</span><span class="mi">2</span><span class="n">B</span><span class="o">%</span><span class="mi">2</span><span class="n">FIfNO4F</span><span class="o">%</span><span class="mi">2</span><span class="n">F7WNoMKDZ4</span>
<span class="n">VVYeBtCEQKWp12pU7vPB5WVVMRMrGB8ZRAdHmmPp0hJ9opO3NdafRc04Z</span><span class="o">%</span><span class="mi">2</span><span class="n">BbfnkSuQCN9NcGV</span><span class="o">%</span><span class="mi">2</span><span class="n">BajT</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">ra169jhaGRReRQ9KkgSB3aTpQGaffAYUPVo2XZiWy6f9Z7zsmV</span><span class="o">%</span><span class="mi">2</span><span class="n">FFoT8dg</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span>
</pre></div>
</div>
</div>
<div class="section" id="binding-http-post">
<h3>Binding HTTP POST<a class="headerlink" href="#binding-http-post" title="Link a questa intestazione">¬∂</a></h3>
<p>Nel caso del binding HTTP POST, come risposta alla richiesta di accesso dell‚Äôutente ad un
servizio o risorsa, il SP invia allo User Agent (il browser dell‚Äôutente) un messaggio HTTP con
status code avente valore 200 (¬´OK¬ª):</p>
<blockquote>
<div><ul class="simple">
<li><strong>il messaggio HTTP contiene una form HTML</strong> all‚Äôinterno della quale √® trasportato un costrutto SAML &lt;AuthnRequest&gt; codificato come valore di un hidden form control di nome ¬´SAMLRequest¬ª. Rispetto al binding HTTP Redirect, l‚Äôutilizzo di una form HTML permette di superare i limiti di dimensione della query string. Pertanto, l‚Äôintero messaggio SAML in formato XML pu√≤ essere firmato in accordo alla specifica XML Digital Signature. Il risultato a valle della firma √® quindi codificato in formato Base64</li>
<li>la form HTML contiene un secondo hidden form control di nome <strong>¬´RelayState¬ª</strong> che contiene il corrispondente valore del Relay State, cio√® della risorsa originariamente richiesta dall‚Äôutente e alla quale dovr√† essere trasferito il controllo al termine della fase di autenticazione</li>
<li><strong>la form HTML √® corredata da uno script che la rende auto-postante</strong> all‚Äôindirizzo indicato nell‚Äôattributo ¬´action¬ª</li>
<li><strong>Il browser</strong> dell‚Äôutente elabora quindi la risposta HTTP e invia una richiesta HTTP POST verso il componente Single Sign-On dell‚ÄôIdentity Provider (interfaccia IAuthnRequest).</li>
</ul>
</div></blockquote>
<p>Un esempio di form HTML per trasferire in HTTP POST la richiesta di autenticazione √® descritto nell‚Äôesempio successivo. Osservando attentamente il codice riportato in figura si pu√≤ notare il valore del parametro ¬´SAMLRequest¬ª (ridotto per brevit√†); il valore del parametro RelayState reso non immediatamente intellegibile (cfr. sez. precedente); l‚Äôelemento <em>&lt;input type=¬ªsubmit¬ª value=¬ªInvia¬ª/&gt;</em>, che ha lo scopo di visualizzare all‚Äôinterno del web browser il pulsante di invio della form utilizzabile dall‚Äôutente, non strettamente necessario in quanto la form √® resa autopostante.</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        [...]
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;javascript:document.forms[0].submit()&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;https://spid.identityprovider.it/SSOServiceProxy&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;SAMLRequest&quot;</span>
                <span class="na">value</span><span class="o">=</span><span class="s">&quot;PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZVRGLTgiPz4KPHNhbWxwOkF1dGhuUmVxdWVzdCBB</span>
<span class="s">                c3NlcnRpb25Db25zdW1lclNlcnZpY2VVUkw9Imh0dHA6Ly9zcC5pY2FyLml0OjgwODAvaWNhc</span>
<span class="s">                [...]</span>
<span class="s">                N0ZWRUcmFuc3BvcnQ8L3NhbWw6QXV0aG5Db250ZXh0Q2xhc3NSZWY+PC9zYW1scDpSZXF1ZXN0ZWRBdXRobkNvb</span>
<span class="s">                nRleHQ+PHNhbWxwOlNjb3BpbmcgUHJveHlDb3VudD0iMiIgeG1sbnM6c2FtbHA9InVybjpvYXNpczpuYW1lczp0</span>
<span class="s">                YzpTQU1MOjIuMDpwcm90b2NvbCIvPjwvc2FtbG5SZXF1ZXN0Pg==&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;RelayState&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;s2645f48777bd62ec83eddc62...&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Invia&quot;</span><span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Conclusa la fase di autenticazione, l‚ÄôIdentity Provider costruisce una <strong>&lt;Response&gt;</strong> firmata diretta al Service Provider, e in particolare al relativo servizio <strong>AssertionConsumerService</strong>. La <strong>&lt;Response&gt;</strong> viene inserita in una form HTML come campo nascosto di nome <strong>¬´SAMLResponse¬ª</strong>. L‚ÄôIdentity Provider invia la form HTML al browser dell‚Äôutente in una risposta HTTP.</p>
<p>Il browser dell‚Äôutente elabora quindi la risposta HTTP e invia una richiesta HTTP POST contenente la <strong>&lt;Response&gt;</strong> firmata verso il Service Provider. Un esempio di tale form √® riportato di seguito, anche in questo caso, il valore del parametro ¬´SAMLResponse¬ª √® stato ridotto per brevit√†</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        [...]
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;javascript:document.forms[0].submit()&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;https://spid.serviceprovider.it/AssertionConsumerService&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;SAMLResponse&quot;</span>
                <span class="na">value</span><span class="o">=</span><span class="s">&quot;PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHNhbWxwOlJlc3BvbnNlIERlc3Rp</span>
<span class="s">                bmF0aW9uPSJodHRwOi8vc3AuaWNhci5pdDo4MDgwL2ljYXItc3AvQXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlIiB</span>
<span class="s">                JRD0iczJhNTdmN2RhYTUyMTc2NWZmOTQ2ODM0ZmY2NjIzNTA3ZTcwNGI1MDQ3IiBJblJlc3BvbnNlVG89InMyOG</span>
<span class="s">                Q5MWEyNmJkNGQ2MGY0N2E0OTkxMzMwMGZhZjc2MzFiZjMxNDBlOSIgSXNzdWVJbnN0YW50PSIyMDA4LTAzLTA0V</span>
<span class="s">                DIyOjEzOjQ4LjUwMFoiIFZlcnNpb249IjIuMCIgeG1sbnM6c2Ftb</span>
<span class="s">                [...]</span>
<span class="s">                2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFjOmNsYXNzZXM6UGFzc3dvcmRQcm90ZWN0ZWRUcmFuc3BvcnQ8L3NhbWw6</span>
<span class="s">                QXV0aG5Db250ZXh0Q2xhc3NSZWY+PC9zYW1sOkF1dGhuQ29udGV4dD48L3NhbWw6QXV0aG5TdGF0ZW1lbnQ+PC9</span>
<span class="s">                zYW1sOkFzc2VydGlvbj48L3NhbWxwOlJlc3BvbnNlPg==&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;RelayState&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;s28d91a26bd4d60f47a49913300f...&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Invia&quot;</span><span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="gestione-della-sicurezza-sul-canale-di-trasmissione">
<h2>Gestione della sicurezza sul canale di trasmissione<a class="headerlink" href="#gestione-della-sicurezza-sul-canale-di-trasmissione" title="Link a questa intestazione">¬∂</a></h2>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Il profilo SAML SSO raccomanda l‚Äôuso di <strong>TLS 1.2</strong> nei colloqui tra Asserting party (Identity Provider e Attribute Authority), le Relaying Party (Service Provider) e lo user agent.
In ambito  SPID si rende obbligatorio l‚Äôimpiego di TLS 1.2.
In casi particolari e temporanei,  pu√≤  essere  adottata  la  versione  1.1,  fermo  restando  che  la  versione  1.2 deve  essere  adottata  lato server.
Conseguentemente, le versioni pi√π obsolete dei browser, che non supportano le versioni del protocollo indicate, non devono essere utilizzate e, i livelli minimi accettati per l‚Äôaccesso ai servizi SPID, devono essere documentati nei confronti degli utenti.</p>
</div>
</div>
<div class="section" id="metadata">
<h2>Metadata<a class="headerlink" href="#metadata" title="Link a questa intestazione">¬∂</a></h2>
<p>Le caratteristiche dell‚ÄôIdentity provider devono essere definite attraverso metadata conformi allo standard SAML v2.0 (SAML-Metadata), e rispettare le condizioni di seguito indicate:</p>
<div class="section" id="entitydescriptor">
<h3>&lt;EntityDescriptor&gt;<a class="headerlink" href="#entitydescriptor" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>nell‚Äôelemento <strong>&lt;EntityDescriptor&gt;</strong> devono essere presenti i seguenti attributi:</p>
<ul class="last simple">
<li><strong>entityID</strong> indicante l‚Äôidentificativo (URI) dell‚Äôentit√† univoco in ambito SPID</li>
<li><strong>ID</strong> univoco, per esempio basato su un Universally Unique Identifier (UUID) o su una combinazione origine + timestamp  (quest‚Äôultimo generato con una precisione di almeno un millesimo di secondo per garantire l‚Äôunivocit√†)</li>
</ul>
</div>
</div>
<div class="section" id="idpssodescriptor">
<h3>&lt;IDPSSODescriptor&gt;<a class="headerlink" href="#idpssodescriptor" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>l‚Äôelemento <strong>&lt;IDPSSODescriptor&gt;</strong> specifico che contraddistingue l‚Äôentit√† di tipo Identity provider deve riportare i seguenti attributi:</dt>
<dd><ul class="first last">
<li><strong>protocolSupportEnumeration</strong>: che enumera gli URI indicanti i protocolli supportati dall‚Äôentit√† (poich√© si tratta di un‚Äôentit√† SAML 2.0, deve indicare almeno il valore del relativo protocollo: ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:protocol">urn:oasis:names:tc:SAML:2.0:protocol</a>¬ª)</li>
<li><strong>WantAuthnRequestSigned</strong>: attributo con valore booleano che impone ai Service Provider che fanno uso di questo Identity provider l‚Äôobbligo della firma delle richieste di autenticazione;</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="keydescriptor">
<h3>&lt;KeyDescriptor&gt;<a class="headerlink" href="#keydescriptor" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p>all‚Äôinterno di IDPSSODescriptor devono essere presenti:</p>
<blockquote class="last">
<div><ul class="simple">
<li>l‚Äôelemento <strong>&lt;KeyDescriptor&gt;</strong> che contiene l‚Äôelenco dei certificati e delle corrispondenti chiavi pubbliche dell‚Äôentit√†, utili per la verifica della firma dei messaggi prodotti da tale entit√† nelle sue interazioni con le altre (SAMLMetadata, par. 2.4.1.1)</li>
<li>l‚Äôelemento <strong>&lt;KeyDescriptor&gt;</strong> che contiene il certificato della corrispondente chiave pubblica dell‚Äôentit√†, utile per la verifica della firma dei messaggi prodotti da tale entit√† nelle sue interazioni con le altre (SAML-Metadata, par. 2.4.1.1)</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="nameidformat">
<h3>&lt;NameIDFormat&gt;<a class="headerlink" href="#nameidformat" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>l‚Äôelemento <strong>&lt;NameIDFormat&gt;</strong> riportante l‚Äôattributo:</dt>
<dd><ul class="first last">
<li><strong>format</strong>, indicante il formato ¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:nameidformat:transient">urn:oasis:names:tc:SAML:2.0:nameidformat:transient</a>¬ª come quello supportato per l‚Äôelemento di <strong>&lt;NameID&gt;</strong> utilizzato nelle richieste e risposte SAML per identificare il subject cui si riferisce un‚Äôasserzione</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="singlelogoutservice">
<h3>&lt;SingleLogoutService&gt;<a class="headerlink" href="#singlelogoutservice" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>uno o pi√π elementi <strong>&lt;SingleLogoutService&gt;</strong> che specificano l‚Äôindirizzo del Single Sign-On Service riportanti i seguenti attributi:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt><strong>Location</strong> url endpoint del servizio per la ricezione delle richieste Binding che pu√≤ assumere uno dei valori</dt>
<dd><ul class="first last">
<li>¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect</a>¬ª</li>
<li>¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST</a>¬ª</li>
</ul>
</dd>
</dl>
</li>
<li><strong>ResponseLocation</strong></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="singlesignonservice">
<h3>&lt;SingleSignOnService&gt;<a class="headerlink" href="#singlesignonservice" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>uno o pi√π elementi <strong>&lt;SingleSignOnService&gt;</strong> che specificano l‚Äôindirizzo del Single Sign-On Service riportanti i seguenti attributi:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt><strong>Location</strong> url endpoint del servizio per la ricezione delle richieste Binding che pu√≤ assumere uno dei valori</dt>
<dd><ul class="first last">
<li>¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect</a>¬ª</li>
<li>¬´<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST</a>¬ª</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="attribute">
<h3>&lt;Attribute&gt;<a class="headerlink" href="#attribute" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>opzionalmente possono essere presenti:
* uno o pi√π elementi <strong>&lt;Attribute&gt;</strong> ad indicare nome e formato degli attributi certificabili dell‚ÄôIdentity provider (Tabella attributi SPID),riportanti gli attributi:</p>
<blockquote class="last">
<div><ul class="simple">
<li><strong>Name</strong> nome dell‚Äôattributo (colonna identificatore della Tabella attributi SPID)</li>
<li><strong>xsi:type</strong> tipo dell‚Äôattributo (colonna tipo della Tabella attributi SPID)</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="id9">
<h3>&lt;Signature&gt;<a class="headerlink" href="#id9" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">deve essere l‚Äôelemento <strong>&lt;Signature&gt;</strong> riportante la firma sui metadata.
La firma deve essere prodotta secondo il profilo specificato per SAML (SAML-Metadata, cap. 3) utilizzando chiavi RSA almeno a 2048 bit e algoritmo di digest SHA-256 o superiore;</p>
</div>
</div>
<div class="section" id="organization">
<h3>&lt;Organization&gt;<a class="headerlink" href="#organization" title="Link a questa intestazione">¬∂</a></h3>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<dl class="last docutils">
<dt>√® consigliata la presenza di un elemento <strong>&lt;Organization&gt;</strong> a indicare l‚Äôorganizzazione a cui afferisce l‚Äôentit√† specificata, riportante gli elementi:</dt>
<dd><ul class="first last simple">
<li><strong>&lt;OrganizationName&gt;</strong> indicante un identificatore language-qualified dell‚Äôorganizzazione a cui l‚Äôentit√† afferisce</li>
<li><strong>&lt;OrganizationURL&gt;</strong> riportante in modalit√† language-qualified la url istituzionale dell‚Äôorganizzazione</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="esempio-metadata-idp">
<h3>Esempio: Metadata IdP<a class="headerlink" href="#esempio-metadata-idp" title="Link a questa intestazione">¬∂</a></h3>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;md:EntityDescriptor</span> <span class="na">xmlns:md =</span> <span class="s">&quot;urn:oasis:names:tc:SAML:2.0:metadata&quot;</span>
    <span class="na">xmlns:saml=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchemainstance&quot;</span>
    <span class="na">entityID=</span><span class="s">&quot;http://spid.identityprovider.it&quot;</span>
    <span class="na">ID=</span><span class="s">&quot;_2ini49248n98dn984n...&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ds:Signature</span> <span class="na">xmlns:ds=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span><span class="nt">&gt;</span>
        [...]
    <span class="nt">&lt;/ds:Signature&gt;</span>
    <span class="nt">&lt;md:IDPSSODescriptor</span>
        <span class="na">protocolSupportEnumeration=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span>
        <span class="na">WantAuthnRequestsSigned=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;md:KeyDescriptor</span> <span class="na">use=</span><span class="s">&quot;signing&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/md:KeyDescriptor&gt;</span>
        <span class="nt">&lt;md:SingleLogoutService</span> <span class="na">Binding=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot;</span>
            <span class="na">Location=</span><span class="s">&quot;https://spid.identityprovider.it/Post-Post-saml2slo&quot;</span>
            <span class="na">ResponseLocation=</span><span class="s">&quot;https://spid.identityprovider.it/Post-Post-saml2slo&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;md:SingleLogoutService</span> <span class="na">Binding=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&quot;</span>
            <span class="na">Location=</span><span class="s">&quot;https://spid.identityprovider.it/redirect-Post-saml2slo&quot;</span>
            <span class="na">ResponseLocation=</span><span class="s">&quot;https://spid.identityprovider.it/redirect-Post-saml2slo&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;md:NameIDFormat&gt;</span>urn:oasis:names:tc:SAML:2.0:nameid-format:transient<span class="nt">&lt;/md:NameIDFormat&gt;</span>
        <span class="nt">&lt;md:SingleSignOnService</span>
            <span class="na">Location=</span><span class="s">&quot;https://spid.identityprovider.it/redirect-Post-saml2sso&quot;</span>
            <span class="na">Binding=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;md:SingleSignOnService</span>
            <span class="na">Location=</span><span class="s">&quot;https://spid.identityprovider.it/Post-Post-saml2sso&quot;</span>
            <span class="na">Binding=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;familyName&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;spidCode&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;fiscalNumber&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;gender&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;dateOfBirth&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;placeOfBirth&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;companyName&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;registeredOffice&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;ivaCode&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;idCard&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;mobilePhone&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;email&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;address&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;saml:Attribute</span> <span class="na">xsi:type=</span><span class="s">&quot;xsi:string&quot;</span> <span class="na">Name=</span><span class="s">&quot;digitalAddress&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/md:IDPSSODescriptor&gt;</span>
<span class="nt">&lt;/md:EntityDescriptor&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="disponibilita-dei-metadata">
<h3>Disponibilit√† dei Metadata<a class="headerlink" href="#disponibilita-dei-metadata" title="Link a questa intestazione">¬∂</a></h3>
<p>I metadata Identity Provider saranno disponibili per tutte le entit√† SPID federate attraverso l‚Äôinterfaccia IMetadataRetrive alla URL <strong>https://&lt;dominioGestoreIdentita&gt;/metadata</strong>, ove non diversamente specificato nel <strong>Registro SPID</strong>, e saranno firmate in modalita detached dall‚ÄôAgenzia per l‚ÄôItalia Digitale.
L‚Äôaccesso deve essere effettuato utilizzando il protocollo TLS nella versione pi√π recente disponibile.</p>
</div>
</div>
</div>


                        </div>
                        <div class="articleComments">
                            
                        </div>
                    </div>
                    <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="regole-tecniche-sp.html" class="btn float-right" title="Regole tecniche Service Provider" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduzione.html" class="btn" title="Introduzione" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, AgID - Agenzia per l&#39;Italia Digitale.
      Ultimo aggiornamento 18/05/2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using the official <a href="https://github.com/italia/sphinx_italia_theme">Italia theme</a> based on the <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
                </div>
            </div>

        </section>

    </div>
    
 

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT: './',
            VERSION: '1.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE: true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>   
    <script type="text/javascript" src="_static/js/theme.js"></script>
      
    <script type="text/javascript">
        jQuery(function() {
            SphinxRtdTheme.StickyNav.enable();
        });
    </script>
     

</body>

</html>